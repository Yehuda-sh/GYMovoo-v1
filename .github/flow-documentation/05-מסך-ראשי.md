# 📊 מסך ראשי (MainScreen)

> **קובץ:** `src/screens/main/MainScreen.tsx`  
> **מטרה:** לוח בקרה מרכזי, סקירת התקדמות ומעבר לפעילויות עיקריות

## 📱 תצוגת המסך

### 🎨 מבנה המסך

- **כותרת אישית** - "שלום [שם המשתמש]"
- **סטטיסטיקות כללי** - אימונים, זמן, רצף
- **כרטיסי מידע** - תוצאות מדעיות, המלצות AI
- **כפתורי פעולה ראשיים** - התחל אימון, פרופיל, היסטוריה
- **ניווט תחתון** - טאבים לניווט מהיר

### 📊 סקירת נתונים

```javascript
// נתונים המוצגים במסך
const userStats = {
  totalWorkouts: 47, // סה"כ אימונים
  totalMinutes: 1420, // סה"כ דקות
  currentStreak: 12, // רצף נוכחי (ימים)
  weeklyGoal: "4/5", // יעד שבועי
  nextWorkout: "אימון חזה", // האימון הבא המומלץ
  lastWorkout: "לפני יומיים", // האימון האחרון
};
```

## 🔘 כפתורים ופעולות עיקריים

### 1️⃣ כפתור "התחל אימון"

**טקסט בממשק:** "התחל אימון"  
**עיצוב:** כפתור גדול וצבעוני במרכז המסך  
**שם הפונקציה:** `handleStartWorkout`

#### 🎯 מה קורה בלחיצה:

```javascript
const handleStartWorkout = () => {
  // 1. בדיקת תוכנית אימון קיימת
  const workoutPlan =
    user?.workoutplans?.smartPlan || user?.workoutplans?.basicPlan;

  if (workoutPlan && workoutPlan.exercises?.length > 0) {
    // יש תוכנית - התחל אימון
    navigation.navigate("Workout", {
      workout: workoutPlan,
      source: "main_screen",
    });
  } else {
    // אין תוכנית - צור תוכנית חדשה
    navigation.navigate("WorkoutPlans", {
      autoGenerate: true,
    });
  }

  // אנליטיקה
  analytics.track("workout_started_from_main");
};
```

#### ➡️ לאן מוביל:

- → **מסך אימון** (`WorkoutScreen`) - אם יש תוכנית
- → **מסך תוכניות אימון** (`WorkoutPlansScreen`) - אם אין תוכנית

### 2️⃣ כפתור פרופיל

**מיקום:** פינה ימנית עליונה  
**עיצוב:** תמונת פרופיל/אווטר קטן  
**שם הפונקציה:** `() => navigation.navigate("Profile")`

#### ➡️ לאן מוביל:

→ **מסך פרופיל** (`ProfileScreen`)

### 3️⃣ כפתור "היסטוריית אימונים"

**טקסט בממשק:** "היסטוריה"  
**מיקום:** חלק תחתון של המסך  
**שם הפונקציה:** `() => navigation.navigate("History")`

#### ➡️ לאן מוביל:

→ **מסך היסטוריה** (`HistoryScreen`)

### 4️⃣ כרטיס "תוכניות אימון"

**טקסט בממשק:** "תוכניות האימון שלי"  
**שם הפונקציה:** `() => navigation.navigate("WorkoutPlans")`

#### ➡️ לאן מוביל:

→ **מסך תוכניות אימון** (`WorkoutPlansScreen`)

### 5️⃣ כרטיס "המלצות AI"

**טקסט בממשק:** "המלצות מותאמות אישית"  
**מטרה:** הצגת המלצות חכמות והתאמות

#### 🎯 תוכן דינמי:

```javascript
const aiRecommendations = {
  nextExercises: ["סקוואט", "דחיפות", "פלאנק"],
  restDayAdvice: "מומלץ יום מנוחה אחרי 3 ימי אימון רצופים",
  nutritionTip: "הקפד לשתות מים לפני ואחרי האימון",
  progressInsight: "השבוע עלית ב-5% בכוח הכללי!",
};
```

### 6️⃣ כפתור הגדרות

**מיקום:** פינה שמאלית עליונה  
**עיצוב:** אייקון הגדרות (⚙️)  
**שם הפונקציה:** `() => navigation.navigate("Settings")`

## 💾 נתונים המוצגים במסך

### 📊 סטטיסטיקות מרכזיות

```javascript
// נתונים נטענים מ-Zustand Store ומעובדים
const displayStats = useMemo(() => {
  const stats = user?.trainingstats || {};
  return {
    totalWorkouts: stats.totalWorkouts || 0,
    totalTime: formatTime(stats.totalMinutes || 0),
    currentStreak: stats.currentStreak || 0,
    level: calculateLevel(stats.xp || 0),
    weeklyProgress: calculateWeeklyProgress(stats),
  };
}, [user?.trainingstats]);
```

### 🏆 הישגים ויעדים

```javascript
const achievements = {
  recentBadges: ["מתחיל נחוש", "5 אימונים ברצף"],
  nextMilestone: "50 אימונים",
  progressToNext: "47/50",
  weeklyGoal: {
    target: 4,
    completed: 3,
    remaining: 1,
  },
};
```

### 📈 תובנות מדעיות

```javascript
const scientificInsights = {
  bodyMassIndex: calculateBMI(user.weight, user.height),
  fitnessAge: calculateFitnessAge(user.stats),
  recommendedCalories: calculateCalories(user.profile),
  recoveryScore: calculateRecovery(user.recentWorkouts),
};
```

## 🔄 טעינת נתונים ועדכונים

### 📥 נתונים נטענים בכניסה למסך

```javascript
useEffect(() => {
  const loadMainScreenData = async () => {
    try {
      // 1. נתונים מ-Store (מיידי)
      const localStats = user?.trainingstats;
      setDisplayData(localStats);

      // 2. עדכון מהשרת (ברקע)
      if (user?.id) {
        const serverStats = await userApi.getStats(user.id);
        setDisplayData(serverStats);

        // עדכון ה-Store
        useUserStore.getState().updateUser({
          trainingstats: serverStats,
        });
      }

      // 3. אנליטיקה
      analytics.track("main_screen_viewed", {
        userId: user?.id,
        hasWorkoutPlan: !!user?.workoutplans,
      });
    } catch (error) {
      console.error("Failed to load main screen data:", error);
      // המשך עם נתונים מקומיים
    }
  };

  loadMainScreenData();
}, [user?.id]);
```

### 🔄 רענון נתונים

```javascript
const refreshData = useCallback(async () => {
  setRefreshing(true)
  try {
    // רענון נתונים מהשרת
    await loadMainScreenData()
  } finally {
    setRefreshing(false)
  }
}, [])

// רענון בגרירה
<ScrollView
  refreshControl={
    <RefreshControl refreshing={refreshing} onRefresh={refreshData} />
  }
>
```

## 🎭 אינטראקציות ואנימציות

### ✨ אנימציות כניסה

```javascript
useEffect(() => {
  // אנימציית fade-in של כרטיסים
  Animated.stagger(100, [
    Animated.timing(statsCardAnim, { toValue: 1, duration: 300 }),
    Animated.timing(workoutCardAnim, { toValue: 1, duration: 300 }),
    Animated.timing(insightsCardAnim, { toValue: 1, duration: 300 }),
  ]).start();
}, []);
```

### 📱 משוב המטי (Haptic Feedback)

```javascript
const handleWorkoutPress = () => {
  // רעידה קלה בלחיצה
  Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
  handleStartWorkout();
};
```

### 🎨 אינטראקציות עם כרטיסים

```javascript
// אנימציית לחיצה על כרטיס
const animateCardPress = (animValue) => {
  Animated.sequence([
    Animated.timing(animValue, { toValue: 0.95, duration: 100 }),
    Animated.timing(animValue, { toValue: 1, duration: 100 }),
  ]).start();
};
```

## 🔍 חיפוש ותגליות

### 🔎 תיבת חיפוש (אופציונלי)

**מיקום:** חלק עליון של המסך  
**מטרה:** חיפוש תרגילים, תוכניות, מאמרים

```javascript
const handleSearch = (query) => {
  navigation.navigate("Search", {
    query,
    categories: ["exercises", "workouts", "articles"],
  });
};
```

## 📊 אנליטיקה ומדידות

### 📈 אירועים נמדדים

```javascript
// כניסה למסך
analytics.track("main_screen_viewed", {
  userId: user?.id,
  sessionStart: new Date(),
  userLevel: calculateLevel(user?.trainingstats?.xp),
});

// לחיצה על "התחל אימון"
analytics.track("start_workout_clicked", {
  source: "main_screen",
  hasWorkoutPlan: !!user?.workoutplans,
  lastWorkout: user?.trainingstats?.lastWorkoutDate,
});

// צפייה בהישגים
analytics.track("achievements_viewed", {
  currentStreak: user?.trainingstats?.currentStreak,
  totalWorkouts: user?.trainingstats?.totalWorkouts,
});
```

## ⚠️ מצבי שגיאה וטיפול

### 🔴 אין חיבור לשרת

```javascript
const handleOfflineMode = () => {
  // הצגת נתונים מקומיים בלבד
  setDisplayData(user?.trainingstats || {});

  // הודעה עדינה
  showToast("פועל במצב לא מקוון", "info");
};
```

### 🔴 נתונים חסרים

```javascript
const handleMissingData = () => {
  if (!user?.trainingstats) {
    // הצגת מסך onboarding מחדש
    navigation.navigate("Questionnaire");
  } else if (!user?.workoutplans) {
    // הצגת הודעה ליצירת תוכנית
    showModal({
      title: "בואו ניצור תוכנית אימון",
      message: "נראה שאין לך תוכנית אימון. בואו ניצור אחת מותאמת אישית!",
      confirmText: "בואו נתחיל",
      onConfirm: () => navigation.navigate("WorkoutPlans"),
    });
  }
};
```

### 🔴 שגיאת טעינה

```javascript
const handleLoadError = (error) => {
  console.error("Main screen load error:", error);

  showModal({
    title: "בעיה בטעינת הנתונים",
    message: "אנא נסה לרענן את המסך או בדוק את החיבור לאינטרנט.",
    confirmText: "נסה שוב",
    onConfirm: refreshData,
  });
};
```

## 🎯 מטרות עסקיות ו-UX

### 1️⃣ עידוד לפעילות

- כפתור "התחל אימון" בולט ונגיש
- הצגת התקדמות לעידוד המשכיות
- תזכורות עדינות ליעדים

### 2️⃣ retention ומעורבות

- הצגת הישגים והתקדמות
- המלצות מותאמות אישית
- גמיפיקציה (רמות, תגים)

### 3️⃣ ניווט אינטואיטיבי

- גישה מהירה לפעילויות עיקריות
- תפריט ברור ומסודר
- חיפוש והתמצאות קלה

## 🎨 מפת זרימה חזותית

```
📊 מסך ראשי
    ├── 🏃 "התחל אימון"
    │   ├── יש תוכנית ──► 🎯 מסך אימון
    │   └── אין תוכנית ──► 📋 תוכניות אימון
    │
    ├── 👤 פרופיל ──► 🔧 מסך פרופיל
    │
    ├── 📈 היסטוריה ──► 📊 מסך היסטוריה
    │
    ├── 📋 תוכניות ──► 🗂️ מסך תוכניות
    │
    ├── ⚙️ הגדרות ──► 🔧 מסך הגדרות
    │
    └── 🔍 חיפוש ──► 🔎 מסך חיפוש
```

## 🔮 שיפורים עתידיים

### 1️⃣ התאמה אישית

- ארגון כרטיסים לפי העדפות
- ווידג'טים ניתנים להזזה
- ערכות נושא מותאמות

### 2️⃣ תובנות מתקדמות

- ניתוח מגמות ארוכות טווח
- השוואה למשתמשים דומים
- חיזוי ביצועים עתידיים

### 3️⃣ אינטגרציות

- חיבור למכשירי כושר חכמים
- סנכרון עם אפליקציות בריאות
- שיתוף הישגים ברשתות חברתיות

---

_עודכן: 4 בספטמבר 2025_
